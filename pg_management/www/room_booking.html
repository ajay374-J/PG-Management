{% extends "templates/web.html" %}

{% block page_content %}



<head>
    <style>
        body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }
    
    .container {
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    h1, h2 {
        color: #333;
    }
    
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    
    input, select {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    
    button {
        background-color: #4caf50;
        color: #fff;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .thankyou {
        font-size: 2rem;
    }
    
    button:hover {
        background-color: #45a049;
    }
    
    hr {
        border: 0;
        height: 1px;
        background: #ddd;
        margin: 20px 0;
    }
    .card {
        border:solid;
        gap: 1rem;
    }
    .card {
    border: 1px solid #ddd;
    padding: 20px;
    border-radius: 8px;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    flex-grow: 1;
    }

    .card h3 {
        color: #333;
        margin-bottom: 10px;
    }

    .card p {
        color: #666;
        margin-bottom: 5px;
    }

    
    .out {
        display: flex;
        gap: 1rem;
        /* border:1px solid black; */
    }
    
    .filling-form {
        display: none;
    }
    
    /* Add more styling as needed */
    
        
    </style>
    </head>
    <body>
    <div class="container">
        <h1>{{ title }}</h1>
        <div id="booking-info">
        <h2>Check Room Availability</h2>
      
            <label for="check-in">Check-in Date:</label>
            <input type="date" id="check-in" name="check-in" value="{{ check_in_date }}" required>
    
            <label for="check-out">Check-out Date:</label>
            <input type="date" id="check-out" name="check-out" value="{{ check_out_date }}" required>
            <label for="room">Room Type:</label>
            <select name="room" id="room">
            <option value="single">Single</option>
            <option value="double">Double</option>
            <option value="triple">Triple</option>
            <option value="multiple">Multiple</option>
            </select>
            <button onclick="get_data()" type="submit">Check Availability</button>
    
       
        <hr>
        <label for="rooom">Please Select from the available Rooms listed below:</label>
        <div class="out" id="output"></div>
        <hr>
        <div class="filling-form" id="form-filling">
            <label for="r-no">Room No:</label>
            <input type="text" id="r-no" required>
            <br>
            <label for="frm-name">Full Name:</label>
            <input type="text" id="frm-name" required>
            <br>
            <label for="age">Age:</label>
            <input type="text" id="age" required>
            <br>
            <label for="gender">Gender:</label>
           <select name="gender" id="gender">
            <option value="Male">Male</option>
            <option value="Female">Female</option></select>
            <br>
            <label for="m-no">Mobile No:</label>
            <input type="text" id="m-no" required>
            <br>
            <label for="add">Address:</label>
            <input type="longtext" id="add" required>
            <button onclick="create_guest()">Submit</button>
            
        </div>
    </div>
    </div>
    <script>
        async function get_data(){
            let check_in=document.getElementById('check-in').value
            let check_out=document.getElementById('check-out').value
            let room=document.getElementById('room').value
            let out=document.getElementById('output')
            
           if(!check_in || !check_out ){
                alert("Date Is required")
                return
           }
            let res= await fetch (`api/method/pg_management.api.get_data?check_in=${check_in}&check_out=${check_out}&room=${room}`)
            
            let val=await res.json()
            out.innerHTML=''
            for (let i of val.message){
                let div=document.createElement('div')
                div.classList.add('card')
                let name=document.createElement('div')
                let avail=document.createElement('div')
                name.innerHTML=`${i.name}`
                if (i.available){
                    avail.innerHTML=`${i.available}`
                }
                div.onclick=()=>show_form(i.name,check_in,check_out,room)
                div.appendChild(name)
                div.appendChild(avail)
                out.append(div)
            }
        }
    
        async function show_form(a,b,c,d){
            console.log('show_form',a,b,c)
            let frm=document.getElementById('form-filling')
            frm.style.display='block'
            let ip0=document.getElementById('r-no')
            let ip1=document.getElementById('frm-name').value
            let ip2=document.getElementById('age').value
            let ip3=document.getElementById('gender').value
            let ip4=document.getElementById('m-no').value
            let ip5=document.getElementById('add').value
            let out=document.getElementById('output')
            
    
            ip0.value=a
        }
        async function create_guest(){
            let check_in=document.getElementById('check-in').value
            let check_out=document.getElementById('check-out').value
            let room=document.getElementById('room').value
            let ip0=document.getElementById('r-no').value
            let ip1=document.getElementById('frm-name').value
            let ip2=document.getElementById('age').value
            let ip3=document.getElementById('gender').value
            let ip4=document.getElementById('m-no').value
            let ip5=document.getElementById('add').value
            let booking_info=document.getElementById('booking-info')
            // window.csrf_token = '{{ csrf_token }}'; 
            frappe.call({
                method:'pg_management.api.create_guest',
                type: 'POST',
                args:{
                    check_in: check_in,
                    check_out: check_out,
                    room:room,
                    r_no:ip0,
                    f_name:ip1,
                    age:ip2,
                    gender:ip3,
                    m_no:ip4,
                    address:ip5

                },
                callback:function(r){
                    // booking_info.style.display="none"
                    booking_info.innerHTML=`<h1 class="thankyou">Thankyou For Booking</h1>`
                }
                
            
            })
        }

        
    </script>
    </body>


    {% endblock %}